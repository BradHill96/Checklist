<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Room Notes</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-color: #fcd303;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 30px auto 0 auto;
      background: #fffbe0;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(100,100,0,0.08);
      padding: 24px 18px 30px 18px;
    }
    h2 {
      color: #4CAF50;
      margin-top: 0;
      text-align: center;
    }
    #roomSelectNotes {
      width: 100%;
      font-size: 16px;
      margin-bottom: 18px;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #d6c203;
      background: #fffde7;
    }
    .notes-list {
      margin-top: 18px;
    }
    .note {
      background: #fcf8b4;
      border: 1px solid #e7d600;
      border-radius: 7px;
      margin-bottom: 14px;
      padding: 12px;
      color: #333;
      word-break: break-word;
    }
    .note-time {
      color: #b19700;
      font-size: 0.95em;
      margin-bottom: 4px;
    }
    .back-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 10px 22px;
      font-size: 1em;
      margin-top: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 6px rgba(100,100,0,0.07);
      display: inline-block;
    }
    .back-btn:hover {
      background-color: #45a049;
    }
    @media (max-width: 700px) {
      .container {
        margin: 10px;
        padding: 12px 5px 20px 5px;
      }
      h2 {
        font-size: 1.2em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Room Notes</h2>
    <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Checklist</button>
    <label for="roomSelectNotes"><b>Show notes for room:</b></label>
    <select id="roomSelectNotes">
      <option value="">--Select Room--</option>
      <script>
        for(let i=1;i<=83;i++)document.write(`<option value="Room ${i}">Room ${i}</option>`);
      </script>
    </select>
    <div class="notes-list" id="notesDisplay">
      <em>Select a room to view its notes.</em>
    </div>
  </div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAqYdMntCLSJ0oyacCGV-gphdrFac6z8xg",
      authDomain: "checklist-7d948.firebaseapp.com",
      projectId: "checklist-7d948",
      storageBucket: "checklist-7d948.appspot.com",
      messagingSenderId: "355052608187",
      appId: "1:355052608187:web:4151f16f3cde8bc236679e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const notesRef = collection(db, "roomNotes");

    const roomSelectNotes = document.getElementById("roomSelectNotes");
    const notesDisplay = document.getElementById("notesDisplay");

    roomSelectNotes.addEventListener("change", async () => {
      const room = roomSelectNotes.value;
      if (!room) {
        notesDisplay.innerHTML = "<em>Select a room to view its notes.</em>";
        return;
      }
      notesDisplay.innerHTML = "<em>Loading notes...</em>";
      try {
        // Query for notes matching this room and order by timestamp
        const q = query(notesRef, where("room", "==", room), orderBy("timestamp", "desc"));
        const snapshot = await getDocs(q);

        // Debug output in browser console
        console.log("Selected room:", room);
        console.log("Notes found:", snapshot.docs.length);

        let html = "";
        snapshot.forEach(doc => {
          const data = doc.data();
          const date = data.timestamp
            ? new Date(data.timestamp).toLocaleString()
            : "(no date)";
          html += `<div class="note">
                      <div class="note-time">${date}</div>
                      <div>${(data.note || "").replace(/\n/g, "<br>")}</div>
                   </div>`;
        });
        notesDisplay.innerHTML = html || "<em>No notes for this room yet.</em>";
      } catch (err) {
        notesDisplay.innerHTML = `<span style="color:red">Error: ${err.message}</span>`;
        console.error(err);
      }
    });
  </script>
</body>
</html>