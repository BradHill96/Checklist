<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Room Checklist</title>
<style>
    body { background-color: #fcd303; font-family: Arial, sans-serif; padding: 20px; }
    select, button, textarea { display: block; margin: 10px 0; font-size: 18px; padding: 10px; }
    label { display: block; margin: 8px 0; font-size: 18px; }
    .checklist { margin-bottom: 20px; }
    #progress { font-weight: bold; margin-top: 10px; }
    .btn { background-color: #4CAF50; color: white; padding: 12px 18px; margin-top: 10px; border: none; cursor: pointer; font-size: 18px; }
    .btn:hover { background-color: #45a049; }
    /* Larger checkboxes */
    input[type="checkbox"].item-checkbox, #checkAll {
      width: 26px;
      height: 26px;
      accent-color: #41C9FA;
      vertical-align: middle;
      margin-right: 12px;
    }
    /* Responsive design */
    @media (max-width: 600px) {
      body { padding: 6px; }
      select, button, textarea { width: 100%; font-size: 20px; }
      label { font-size: 20px; }
      .btn { width: 100%; font-size: 20px; }
      #firebase-notes { padding: 10px; margin-top: 15px; }
      #progress { font-size: 18px; }
    }
</style>
</head>
<body>
<h2>Room Checklist</h2>
<label for="roomSelect">Select Room:</label>
<select id="roomSelect">
  <option value="">--Select Room--</option>
  <option value="Room 1">Room 1</option>
  <option value="Room 2">Room 2</option>
  <option value="Room 3">Room 3</option>
  <option value="Room 4">Room 4</option>
  <option value="Room 5">Room 5</option>
  <option value="Room 6">Room 6</option>
  <option value="Room 7">Room 7</option>
  <option value="Room 8">Room 8</option>
  <option value="Room 9">Room 9</option>
  <option value="Room 10">Room 10</option>
  <option value="Room 11">Room 11</option>
  <option value="Room 12">Room 12</option>
  <option value="Room 13">Room 13</option>
  <option value="Room 14">Room 14</option>
  <option value="Room 15">Room 15</option>
  <option value="Room 16">Room 16</option>
  <option value="Room 17">Room 17</option>
  <option value="Room 18">Room 18</option>
  <option value="Room 19">Room 19</option>
  <option value="Room 20">Room 20</option>
  <option value="Room 21">Room 21</option>
  <option value="Room 22">Room 22</option>
  <option value="Room 23">Room 23</option>
  <option value="Room 24">Room 24</option>
  <option value="Room 25">Room 25</option>
  <option value="Room 26">Room 26</option>
  <option value="Room 27">Room 27</option>
  <option value="Room 28">Room 28</option>
  <option value="Room 29">Room 29</option>
  <option value="Room 30">Room 30</option>
  <option value="Room 31">Room 31</option>
  <option value="Room 32">Room 32</option>
  <option value="Room 33">Room 33</option>
  <option value="Room 34">Room 34</option>
  <option value="Room 35">Room 35</option>
  <option value="Room 36">Room 36</option>
  <option value="Room 37">Room 37</option>
  <option value="Room 38">Room 38</option>
  <option value="Room 39">Room 39</option>
  <option value="Room 40">Room 40</option>
  <option value="Room 41">Room 41</option>
  <option value="Room 42">Room 42</option>
  <option value="Room 43">Room 43</option>
  <option value="Room 44">Room 44</option>
  <option value="Room 45">Room 45</option>
  <option value="Room 46">Room 46</option>
  <option value="Room 47">Room 47</option>
  <option value="Room 48">Room 48</option>
  <option value="Room 49">Room 49</option>
  <option value="Room 50">Room 50</option>
  <option value="Room 51">Room 51</option>
  <option value="Room 52">Room 52</option>
  <option value="Room 53">Room 53</option>
  <option value="Room 54">Room 54</option>
  <option value="Room 55">Room 55</option>
  <option value="Room 56">Room 56</option>
  <option value="Room 57">Room 57</option>
  <option value="Room 58">Room 58</option>
  <option value="Room 59">Room 59</option>
  <option value="Room 60">Room 60</option>
  <option value="Room 61">Room 61</option>
  <option value="Room 62">Room 62</option>
  <option value="Room 63">Room 63</option>
  <option value="Room 64">Room 64</option>
  <option value="Room 65">Room 65</option>
  <option value="Room 66">Room 66</option>
  <option value="Room 67">Room 67</option>
  <option value="Room 68">Room 68</option>
  <option value="Room 69">Room 69</option>
  <option value="Room 70">Room 70</option>
  <option value="Room 71">Room 71</option>
  <option value="Room 72">Room 72</option>
  <option value="Room 73">Room 73</option>
  <option value="Room 74">Room 74</option>
  <option value="Room 75">Room 75</option>
  <option value="Room 76">Room 76</option>
  <option value="Room 77">Room 77</option>
  <option value="Room 78">Room 78</option>
  <option value="Room 79">Room 79</option>
  <option value="Room 80">Room 80</option>
  <option value="Room 81">Room 81</option>
  <option value="Room 82">Room 82</option>
  <option value="Room 83">Room 83</option>
</select>

<div class="checklist">
  <label><input type="checkbox" id="checkAll"/> <strong>Check All</strong></label>
  <label><input type="checkbox" class="item-checkbox" value="SA"/> üßë‚Äç‚öïÔ∏è SA</label>
  <label><input type="checkbox" class="item-checkbox" value="NC"/> üìû NC</label>
  <label><input type="checkbox" class="item-checkbox" value="Bed Mat"/> üõèÔ∏è Bed Mat</label>
  <label><input type="checkbox" class="item-checkbox" value="Chair Mat"/> ü™ë Chair Mat</label>
  <label><input type="checkbox" class="item-checkbox" value="Shower"/> üöø Shower</label>
  <label><input type="checkbox" class="item-checkbox" value="Ensuite"/> üöΩ Ensuite</label>
  <label><input type="checkbox" class="item-checkbox" value="Blank Plates Installed"/> üß∞ Blank Plates Installed</label>
  <label><input type="checkbox" class="item-checkbox" value="Tidied"/> üßπ Tidied</label>
</div>
<button id="submitBtn">Submit</button>
<button id="viewBtn">View Saved Data</button>
<button id="exportBtn">Export Data</button>
<button id="eraseBtn">Erase Selected Room Data</button>
<button id="clearAllBtn">Clear All Data</button>
<textarea cols="50" id="dataBox" placeholder="Saved data will appear here..." rows="10"></textarea>
<div id="progress">Progress: 0%</div>

<div id="firebase-notes" style="background-color: #41C9FA; padding: 15px; border-radius: 8px; margin-top: 20px;">
  <h3>Room Notes</h3>
  <textarea cols="50" id="noteInput" placeholder="Enter your note here..." rows="4"></textarea>
  <br/>
  <button id="saveNoteBtn">Save Note</button>
  <div id="firebase-notes" style="background-color: #41C9FA; padding: 15px; border-radius: 8px; margin-top: 20px;">
  <h3>Room Notes</h3>
  <textarea cols="50" id="noteInput" placeholder="Enter your note here..." rows="4"></textarea>
  <br/>
  <button id="saveNoteBtn">Save Note</button>
  <!-- New View Notes button below Save Note -->
  <button onclick="window.location.href='index-notes.html'" class="view-notes-btn">View Notes</button>
  <div id="notesDisplay" style="margin-top: 20px;"></div>
</div>
  <div id="notesDisplay" style="margin-top: 20px;"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
  import { getFirestore, collection, setDoc, doc, getDocs, deleteDoc, addDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAqYdMntCLSJ0oyacCGV-gphdrFac6z8xg",
    authDomain: "checklist-7d948.firebaseapp.com",
    projectId: "checklist-7d948",
    storageBucket: "checklist-7d948.appspot.com",
    messagingSenderId: "355052608187",
    appId: "1:355052608187:web:4151f16f3cde8bc236679e"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Elements
  const roomSelect = document.getElementById("roomSelect");
  const checkboxes = document.querySelectorAll(".item-checkbox");
  const submitBtn = document.getElementById("submitBtn");
  const viewBtn = document.getElementById("viewBtn");
  const exportBtn = document.getElementById("exportBtn");
  const eraseBtn = document.getElementById("eraseBtn");
  const clearAllBtn = document.getElementById("clearAllBtn");
  const dataBox = document.getElementById("dataBox");
  const progress = document.getElementById("progress");
  const checkAll = document.getElementById("checkAll");
  const noteInput = document.getElementById("noteInput");
  const saveNoteBtn = document.getElementById("saveNoteBtn");
  const notesDisplay = document.getElementById("notesDisplay");

  // Progress
  async function updateProgress() {
    const checklistRef = collection(db, "roomChecklist");
    const snapshot = await getDocs(checklistRef);
    const completed = snapshot.size;
    const percent = Math.round((completed / 83) * 100);
    progress.textContent = `Progress: ${percent}%`;
  }

  submitBtn.onclick = async () => {
    const room = roomSelect.value;
    if (!room) return alert("Please select a room.");
    const items = Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value);
    const timestamp = new Date().toISOString();
    await setDoc(doc(db, "roomChecklist", room), { room, items, timestamp });
    alert("Data submitted!");
    checkboxes.forEach(cb => cb.checked = false);
    checkAll.checked = false;
    updateProgress();
  };

  viewBtn.onclick = async () => {
    const checklistRef = collection(db, "roomChecklist");
    const snapshot = await getDocs(checklistRef);
    let output = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      output += `${data.room}: ${data.items.join(", ")} (${data.timestamp})\n`;
    });
    dataBox.value = output;
  };

  exportBtn.onclick = async () => {
    const checklistRef = collection(db, "roomChecklist");
    const snapshot = await getDocs(checklistRef);
    let output = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      output += `${data.room}: ${data.items.join(", ")} (${data.timestamp})\n`;
    });
    const blob = new Blob([output], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "room_checklist.txt";
    link.click();
  };

  eraseBtn.onclick = async () => {
    const room = roomSelect.value;
    if (!room) return alert("Please select a room.");
    if (confirm(`Are you sure you want to erase data for ${room}?`)) {
      await deleteDoc(doc(db, "roomChecklist", room));
      alert("Room data erased.");
      updateProgress();
    }
  };

  clearAllBtn.onclick = async () => {
    if (confirm("Are you sure you want to clear ALL data?")) {
      const checklistRef = collection(db, "roomChecklist");
      const snapshot = await getDocs(checklistRef);
      const promises = [];
      snapshot.forEach(doc => { promises.push(deleteDoc(doc.ref)); });
      await Promise.all(promises);
      alert("All data cleared.");
      updateProgress();
    }
  };

  // "Check All" logic
  checkAll.addEventListener('change', function() {
    checkboxes.forEach(cb => cb.checked = checkAll.checked);
  });
  checkboxes.forEach(cb => {
    cb.addEventListener('change', function() {
      checkAll.checked = Array.from(checkboxes).every(cb => cb.checked);
    });
  });

  updateProgress();

  // --- Notes Section ---
  async function saveNote() {
    const room = roomSelect.value;
    const note = noteInput.value;
    const timestamp = new Date().toISOString();
    if (!room) return alert("Please select a room.");
    if (note.trim() === "") return;
    await addDoc(collection(db, "roomNotes"), { room, note, timestamp });
    noteInput.value = "";
    loadNotes();
  }

  // This function will populate both the textarea and notesDisplay
  async function loadNotes() {
    const room = roomSelect.value;
    if (!room) { 
      notesDisplay.innerHTML = ""; 
      noteInput.value = "";
      return; 
    }
    // Get notes for the selected room only, ordered by newest first
    const q = query(collection(db, "roomNotes"), where("room", "==", room), orderBy("timestamp", "desc"));
    const querySnapshot = await getDocs(q);
    let html = "<h4>Saved Notes:</h4>";
    if (querySnapshot.empty) {
      html += "<p style='color:gray;'>No notes for this room.</p>";
      noteInput.value = "";
    } else {
      let first = true;
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        if (first) {
          noteInput.value = data.note;
          first = false;
        }
        html += `<p><strong>${new Date(data.timestamp).toLocaleString()}</strong>: ${data.note}</p>`;
      });
    }
    notesDisplay.innerHTML = html;
  }
  saveNoteBtn.onclick = saveNote;
  roomSelect.addEventListener("change", loadNotes);
  window.addEventListener("load", loadNotes);
</script>
</body>
</html>